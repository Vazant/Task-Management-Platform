<!-- Skeleton loader -->
<div *ngIf="loading" class="project-card-skeleton">
  <div class="skeleton-header">
    <div class="skeleton-checkbox"></div>
    <div class="skeleton-title"></div>
    <div class="skeleton-menu"></div>
  </div>
  <div class="skeleton-content">
    <div class="skeleton-description"></div>
    <div class="skeleton-description short"></div>
  </div>
  <div class="skeleton-footer">
    <div class="skeleton-chip"></div>
    <div class="skeleton-chip"></div>
  </div>
</div>

<!-- Project card content -->
<mat-card
  *ngIf="!loading"
  class="project-card"
  [class.disabled]="disabled"
  [class.selected]="isSelected"
  [class.hovered]="isHovered"
  [attr.data-project-id]="project.id"
  (click)="onCardClick($event)">

  <!-- Card header -->
  <mat-card-header class="card-header">
    <!-- Selection checkbox -->
    <mat-checkbox
      *ngIf="showSelection"
      class="selection-checkbox"
      [checked]="isSelected"
      (change)="onSelectionChange($event.checked)"
      (click)="$event.stopPropagation()"
      [disabled]="disabled">
    </mat-checkbox>

    <!-- Project title -->
    <mat-card-title class="project-title" [matTooltip]="project.name">
      {{ project.name }}
    </mat-card-title>

    <!-- Actions menu -->
    <div class="card-actions" *ngIf="showActions && !disabled">
      <button
        mat-icon-button
        [matMenuTriggerFor]="actionsMenu"
        class="actions-trigger"
        (click)="$event.stopPropagation()"
        [matTooltip]="'Действия'">
        <lucide-icon name="more-vertical" [size]="18"></lucide-icon>
      </button>

      <mat-menu #actionsMenu="matMenu" class="actions-menu">
        <button
          mat-menu-item
          (click)="onAction('edit')"
          [matTooltip]="'Редактировать проект'">
          <lucide-icon name="edit" [size]="16"></lucide-icon>
          <span>Редактировать</span>
        </button>

        <button
          mat-menu-item
          (click)="onAction('duplicate')"
          [matTooltip]="'Дублировать проект'">
          <lucide-icon name="copy" [size]="16"></lucide-icon>
          <span>Дублировать</span>
        </button>

        <button
          mat-menu-item
          (click)="onAction('share')"
          [matTooltip]="'Поделиться проектом'">
          <lucide-icon name="share-2" [size]="16"></lucide-icon>
          <span>Поделиться</span>
        </button>

        <mat-divider></mat-divider>

        <button
          mat-menu-item
          (click)="onAction('archive')"
          [matTooltip]="'Архивировать проект'">
          <lucide-icon name="archive" [size]="16"></lucide-icon>
          <span>Архивировать</span>
        </button>

        <button
          mat-menu-item
          class="delete-action"
          (click)="onAction('delete')"
          [matTooltip]="'Удалить проект'">
          <lucide-icon name="trash-2" [size]="16"></lucide-icon>
          <span>Удалить</span>
        </button>
      </mat-menu>
    </div>
  </mat-card-header>

  <!-- Card content -->
  <mat-card-content class="card-content">
    <!-- Project description -->
    <p class="project-description" *ngIf="project.description">
      {{ project.description }}
    </p>
    <p class="project-description empty" *ngIf="!project.description">
      Описание отсутствует
    </p>

    <!-- Project settings summary -->
    <div class="project-settings" *ngIf="project.settings">
      <div class="setting-item" *ngIf="project.settings.requireTimeTracking">
        <lucide-icon name="clock" [size]="14"></lucide-icon>
        <span>Учет времени</span>
      </div>
      <div class="setting-item" *ngIf="project.settings.autoAssignTasks">
        <lucide-icon name="check-circle" [size]="14"></lucide-icon>
        <span>Автоназначение</span>
      </div>
    </div>
  </mat-card-content>

  <!-- Card footer -->
  <mat-card-actions class="card-footer">
    <!-- Status chip -->
    <mat-chip
      *ngIf="showStatus"
      class="status-chip"
      [class]="getStatusConfig(project.status || 'active').class"
      [color]="getStatusConfig(project.status || 'active').color">
      <lucide-icon
        [name]="getStatusIconName(project.status || 'active')"
        [size]="14">
      </lucide-icon>
      {{ getStatusConfig(project.status || 'active').label }}
    </mat-chip>

    <!-- Members count -->
    <div class="members-info" *ngIf="showMembers && getMemberCount() > 0">
      <lucide-icon name="users" [size]="14"></lucide-icon>
      <span>{{ getMemberCount() }} участников</span>
    </div>

    <!-- Creation date -->
    <div class="date-info" *ngIf="showDates">
      <lucide-icon name="calendar" [size]="14"></lucide-icon>
      <span [matTooltip]="getFormattedDate(project.createdAt)">
        {{ getRelativeDate(project.createdAt) }}
      </span>
    </div>
  </mat-card-actions>
</mat-card>
