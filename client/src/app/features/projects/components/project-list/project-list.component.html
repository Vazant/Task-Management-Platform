<div class="project-list-container">
  <!-- Header -->
  <div class="project-list-header">
    <div class="header-content">
      <h1>Проекты</h1>
      <button 
        mat-raised-button 
        color="primary" 
        (click)="onCreateProject()"
        class="create-project-btn">
        <mat-icon>add</mat-icon>
        Создать проект
      </button>
    </div>
  </div>

  <!-- Statistics -->
  <div class="project-statistics" *ngIf="statistics$ | async as stats">
    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-value">{{ stats.total }}</div>
            <div class="stat-label">Всего</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">{{ stats.active }}</div>
            <div class="stat-label">Активных</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">{{ stats.completed }}</div>
            <div class="stat-label">Завершенных</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">{{ stats.completionRate | number:'1.0-1' }}%</div>
            <div class="stat-label">Завершение</div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Filters and Search -->
  <div class="project-filters">
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Поиск проектов</mat-label>
      <input 
        matInput 
        [(ngModel)]="searchQuery"
        (input)="onSearch($event.target.value)"
        placeholder="Введите название проекта...">
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>

    <mat-form-field appearance="outline" class="filter-field">
      <mat-label>Фильтр по статусу</mat-label>
      <mat-select [(value)]="selectedFilter" (selectionChange)="onFilter($event.value)">
        <mat-option value="">Все проекты</mat-option>
        <mat-option value="ACTIVE">Активные</mat-option>
        <mat-option value="COMPLETED">Завершенные</mat-option>
        <mat-option value="ARCHIVED">Архивные</mat-option>
        <mat-option value="ON_HOLD">Приостановленные</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading$ | async">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Загрузка проектов...</p>
  </div>

  <!-- Error State -->
  <div class="error-container" *ngIf="error$ | async as error">
    <mat-card class="error-card">
      <mat-card-content>
        <div class="error-content">
          <mat-icon color="warn">error</mat-icon>
          <p>{{ error }}</p>
          <button mat-button color="primary" (click)="loadProjects()">
            Попробовать снова
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Projects Grid -->
  <div class="projects-grid" *ngIf="!(loading$ | async) && !(error$ | async)">
    <mat-card 
      *ngFor="let project of projects$ | async; trackBy: trackByProjectId" 
      class="project-card"
      [class.selected]="false">
      
      <mat-card-header>
        <div mat-card-avatar class="project-avatar" [style.background-color]="project.color">
          {{ project.name.charAt(0).toUpperCase() }}
        </div>
        <mat-card-title>{{ project.name }}</mat-card-title>
        <mat-card-subtitle>
          <span class="project-status" [ngClass]="getProjectStatusClass(project.status)">
            {{ project.status }}
          </span>
          <span class="project-priority" [ngClass]="getProjectPriorityClass(project.priority)">
            {{ project.priority }}
          </span>
        </mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <p class="project-description" *ngIf="project.description">
          {{ project.description }}
        </p>
        
        <div class="project-progress" *ngIf="project.tasksCount && project.tasksCount > 0">
          <div class="progress-info">
            <span>Прогресс: {{ getProjectProgress(project) }}%</span>
            <span>{{ project.completedTasksCount || 0 }} / {{ project.tasksCount }} задач</span>
          </div>
          <mat-progress-bar 
            mode="determinate" 
            [value]="getProjectProgress(project)">
          </mat-progress-bar>
        </div>

        <div class="project-tags" *ngIf="project.tags && project.tags.length > 0">
          <mat-chip-set>
            <mat-chip *ngFor="let tag of project.tags">{{ tag }}</mat-chip>
          </mat-chip-set>
        </div>

        <div class="project-meta">
          <div class="project-dates" *ngIf="project.startDate || project.endDate">
            <span *ngIf="project.startDate">
              <mat-icon>play_arrow</mat-icon>
              {{ project.startDate | date:'dd.MM.yyyy' }}
            </span>
            <span *ngIf="project.endDate">
              <mat-icon>flag</mat-icon>
              {{ project.endDate | date:'dd.MM.yyyy' }}
            </span>
          </div>
          <div class="project-owner">
            <mat-icon>person</mat-icon>
            {{ project.ownerName || 'Неизвестно' }}
          </div>
        </div>
      </mat-card-content>

      <mat-card-actions>
        <button mat-button (click)="onProjectSelect(project)">
          <mat-icon>visibility</mat-icon>
          Открыть
        </button>
        <button mat-button (click)="onEditProject(project)">
          <mat-icon>edit</mat-icon>
          Редактировать
        </button>
        <button mat-icon-button [matMenuTriggerFor]="projectMenu">
          <mat-icon>more_vert</mat-icon>
        </button>
        
        <mat-menu #projectMenu="matMenu">
          <button mat-menu-item (click)="onDuplicateProject(project)">
            <mat-icon>content_copy</mat-icon>
            Дублировать
          </button>
          <button mat-menu-item (click)="onArchiveProject(project)">
            <mat-icon>archive</mat-icon>
            Архивировать
          </button>
          <mat-divider></mat-divider>
          <button mat-menu-item (click)="onDeleteProject(project)" class="delete-action">
            <mat-icon>delete</mat-icon>
            Удалить
          </button>
        </mat-menu>
      </mat-card-actions>
    </mat-card>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!(loading$ | async) && !(error$ | async) && (projects$ | async)?.length === 0">
    <mat-card class="empty-card">
      <mat-card-content>
        <div class="empty-content">
          <mat-icon class="empty-icon">folder_open</mat-icon>
          <h3>Нет проектов</h3>
          <p>Создайте свой первый проект, чтобы начать работу</p>
          <button mat-raised-button color="primary" (click)="onCreateProject()">
            <mat-icon>add</mat-icon>
            Создать проект
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>